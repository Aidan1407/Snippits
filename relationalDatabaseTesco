
from guizero import App, Window, PushButton, Text, CheckBox, ListBox, TextBox, ButtonGroup, Picture, Combo, Box,info  #window is second form
#
# https://lawsie.github.io/guizero/app/
#
#This is needed for the sql database
import sqlite3
from sqlite3 import Error
#Import SQL
import os
import os.path
#Import datetime
import datetime
#
#
#Define the DDL SQL to make the tables
#
#
#Tables created in database with the following details below
sql = """
CREATE TABLE "CUSTOMER_DETAILS" ( 
"customerID" INTEGER NOT NULL,
"userName" TEXT,
"userPassword" TEXT,
"userFirstname" TEXT,
"userlastname" TEXT,
"userAdress" TEXT,
"userPostcode" TEXT, 
"userTown" TEXT, 
PRIMARY KEY("customerID" AUTOINCREMENT)
);
CREATE TABLE "REVIEW_TABLE" (
"reviewID"  INTEGER NOT NULL,
"reviewWriteup" STRING,
"reviewDate" INTEGER,
"reviewTopic"  STRING,
"customerID"  INTEGER,
PRIMARY KEY("reviewID" AUTOINCREMENT),
CONSTRAINT "customerID_FK"  FOREIGN KEY("customerID") REFERENCES "CUSTOMER_DETAILS"("customerID")
);
insert into CUSTOMER_DETAILS (userName, userPassword, userFirstName, userlastname, userAdress, userPostcode, userTown) values ('userjosh','password', 'Josh', 'Tice', '90 roundway', 'po7 7QB', 'Portsmouth');
insert into CUSTOMER_DETAILS (userName, userPassword, userFirstName, userlastname, userAdress, userPostcode, userTown) values ('useraidan','pass', 'Aidan', 'Channing', '18 Admirality Crescent', 'Po7 5FJ', 'Portsmouth');
insert into REVIEW_TABLE (reviewID, reviewWriteup, reviewDate, reviewtopic, customerID) values ('1234', 'Joshpics', '21/03/21', 'Joshs Picsâ„¢','1');
"""
#
#Global variables here
#
#
database_file = 'TescoApp.db'
#
#
#
#Delete the database, only if it exists
#
#
if os.path.exists(database_file):
   os.remove(database_file)
#
#Connect to the database
conn = sqlite3.connect(database_file) #My connection is called 'conn'
#Get a cursor pointing to the database
cursor = conn.cursor()
#Create the tables
cursor.executescript(sql) # creates from DDL above, script more than 1 command
#Commit to save everything
conn.commit()
#Close the connection to the database
#
#Queries the database using the database parameter as the database
#to query and the query parameter as the actual query to issue
# for SELECT
#
def query_database(database, query):
	Lconn = sqlite3.connect(database)
	cur = Lconn.cursor()			# use a local cursor
	cur.execute(query)
	rows = cur.fetchall()
	cur.close()
	return rows
#
#
#Executes the sql statement to INSERT and UPDATE rows
#
def execute_sql(database, sql_statement):
	Lconn = sqlite3.connect(database)
	cur = Lconn.cursor()
	cur.execute(sql_statement)
	conn.commit()
	return cur.lastrowid
#
def back():
	window_L.hide()
	window_S.hide()
	app.show()

def open_window_L():
    window_L.show(wait = True)

def open_window_S():
    window_S.show(wait = True)
#
# login sql
#


def login_user():  #### TEST WITH 'or 1 = 1; -- 
	global user_LoggedIn ## variable needed to know who logged in ##
	if user_textbox.value == " ":
		info("Error", "You must enter a valid username")
	elif PW_textbox.value == " ":
		info("Error", "You must enter a password")
	else:
		info("Log in","Success")
			
#
#
#
#################################
# build main window             #
#################################
app = App(title="Tesco", height = 600)
text_blank = Text(app, text=" ")
text_blank = Text(app, text=" Welcome to Tesco ")
text_blank = Text(app, text=" ")
text = Text(app, text= " ")

text_blank = Text(app, text=" ")
text = Text(app, text= " ")

#
text_blank = Text(app, text=" ")
text_blank = Text(app, text=" ")
open_button = PushButton(app, text="Sign in", command=open_window_S) # button on app, main window

open_button = PushButton(app, text="Log in", command=open_window_L) # button on app, main window
app.bg = "light blue"
text_blank = Text(app, text=" ")

#
#
#
#################################
# login window             #
#################################
window_L = Window(app, title = "Login Window", height=300, width=200)


text_blank = Text(window_L, text=" ")
text_blank = Text(window_L, text=" Welcome to Tesco ")
text_blank = Text(window_L, text=" ")
text = Text(window_L, text= "Enter user name")
user_textbox = TextBox(window_L)
text_blank = Text(window_L, text=" ")
text = Text(window_L, text= "Enter user Password")
PW_textbox = TextBox(window_L)
#
text_blank = Text(window_L, text=" ")
text_blank = Text(window_L, text=" ")
open_button = PushButton(window_L, text="Log in", command=login_user) # button on app, main window
back_button = PushButton(window_L, text="back", command=back, align = "bottom left") # button on app, main window
window_L.bg = "light blue"
text_blank = Text(window_L, text=" ")
window_L.hide()

#################################
# sign in  window             #
#################################
window_S = Window(app, title = "Sign Up Window", height=300, width=200)


text_blank = Text(window_S, text=" ")
text_blank = Text(window_S, text=" Welcome to Tesco ")
text_blank = Text(window_S, text=" ")
text = Text(window_S, text= "Enter first name")
FN_textbox = TextBox(window_S)
text = Text(window_S, text= "Enter surname")
SN_textbox = TextBox(window_S)
text = Text(window_S, text= "Enter user Password")
PW_textbox = TextBox(window_S)
text = Text(window_S, text= "Enter user Phone Number")
PN_textbox = TextBox(window_S)
text = Text(window_S, text= "Enter user Email")
EM_textbox = TextBox(window_S)
text = Text(window_S, text= "Enter user Credit Card Number")
CC_textbox = TextBox(window_S)
#
text_blank = Text(window_S, text=" ")
text_blank = Text(window_S, text=" ")
open_button = PushButton(window_S, text="Sign Up", command=login_user) # button on app, main window
back_button = PushButton(window_S	, text="back", command=back, align = "bottom left") # button on app, main window

window_S.bg = "light blue"
text_blank = Text(window_S, text=" ")
window_S.hide()


#
#
#
app.display()
